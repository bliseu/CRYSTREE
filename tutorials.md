# CRYS
###### BY LI BIN, WRITTEN @ EDINBURGH
CRYS is an acronym for "Crys Rebuild Your Structures", a crystal structure predictor based on machine learning.

### Installation

1. Unpack *crystree.tar.xz*:
   
   ```tar xJf crystree.tar.xz```
   
2. Unpack *examples.tar.xz*:

   ```unzip examples.zip```

   *ex01_BN_300GPa* shows how to obtain the structure of *BN* at 300 GPa.

3. Add CRYSTREE and the templates' path to environment variables, replace *"YOURPATH"*:

   ```export PATH=YOURPATH/crystree/:YOURPATH/crystree/crystree_templates:${PATH}```

   Users can add this line to the end of *~/.bashrc* and ``source ~/.bashrc``

### Commands and scripts of CRYSTREE

​       Under *YOURPATH/crystree* and *YOURPATH/crystree/crystree_templates*, we can find several executable programs and script templates:

1. Commands:

   ```
   1. initStructs #Generate inital structures
   2. readCars    #Read calculation results
   3. mlpp        #Using machine learning to generate structures for next generation
   4. writeCars   #Write structures
   5. cif2poscar  #Convert cif format to POSCAR format
   6. convexhull  #Generate convex hull diagram for variable composition searching
   ```

2. Scripts:

   ```
   1. run_mlpp.job   #Script for fixed composition calculation (PBS system)
   2. run_vcs.job    #Script for variable composition searching
   3. clean.job      #Clean current directory for fixed composition calculation
   4. veryclean.job  #Reduce the size of current directory
   5. convexhull.job #Collect data to convexhull.dat for convexhull command
   6. clean_vcs.job  #Clean directory for variable composition searching
   ```
   
   

### Steps for a single calculation with fixed composition

1. Generate input files with *initStructs*. If *input.txt* does not exists, CRYSTREE will ask the input parameters and generate initial structs with random symmetry, alternatively, you can also create *input.txt* from the template:
   
   ```initStructs```
   
   Here is a template of *input.txt*:
   
   ``` 
   Title =  bn
   Elements =  B N      #When initStructs finished, please check the order of elements in POSCARs, the order of the elements here MUST be consistent with the POSCARs and POTCAR.   
   Composition = 1 1
   Volume_factor =  1.0 #No need to change
   Popsize =  10        #Population for each step
   Ratio =  0.6         #It means 60% of structures are generated by machine learning
   Pressure =  300.0    #Unit is GPa
   Maxstep =  20        #CRYSTREE must stop at Maxstep
   Stopit =  5          #If lowest enthapy stays unchanged for "Stopit" steps, CRYSTREE stops
   ```
   
2. Copy script templates:
   
   ```cp YOURPATH/crystree/crystree_templates/* ./```
   
3. Prepare *POTCAR*, *POTCAR* should contains all pseudos for elements in right order, e.g.:
   
   ```cat PATH_TO_VASP-POT/B/POTCAR > POTCAR```

   ```cat PATH_TO_VASP-POT/C/POTCAR >> POTCAR```

   ```......```

   Here you should give your own *PATH_TO_VASP-POT* .
   
4. Edit *run_mlpp.job*, give your path of *vasp* and *crystree*, then submit job. Here *run_mlpp.job* is a template of PBS job script, users can modify the script easily to fit other job systems.  In *run_mlpp.job*, we recommend a well tested five-step optimization to get the local minimal states, one can try three-or-two-step optimization to see what will happen to the results.
   
   ```vi run_mlpp.job```

   ```
   MAXTIME=1000                 #MAXTIME and WALLTIME control the maximal running time of VASP
   WALLTIME=1000
   VASP='YOURPATH/vasp_std'     #Give your path to vasp
   CRYSTREE='YOURPATH/crystree' #Give your path to CRYSTREE
   ......
   ```
   
   ```qsub run_mlpp.job```
   
5. We can find the results in the work directory, *sort_outputs.txt* gives the best structs with space groups, and *order.txt* gives the sorted enthalpies. 
   
   ```vi sort_outputs.txt```

   ```
   Structure 82 with spacegroup # 216 F-43m
   Structure 101 with spacegroup # 216 F-43m
   Structure 91 with spacegroup # 216 F-43m
   Structure 92 with spacegroup # 216 F-43m
   Structure 102 with spacegroup # 216 F-43m
   Structure 81 with spacegroup # 216 F-43m
   
   .......
   ```
   
   We can see that NO. 82 structure with *F-43m* symmetry is the best structure. The original and optimized structs in *vasp* and *cif* formats are shown in *cars/*:
   
   ```ls cars/```
   
   We can find a *OPTMIZED_82_symmetry.cif* file, that is the cif file with symmetry for NO. 82 structure. Cif file without symmetry is *OPTMIZED_82.cif*.
   
6.  Clean directory, there are two scripts: *clean.job* will create a new results directory tailed with number (e.g. *results1*) and move files into it, and *veryclean.job* will reduce the size of the directory:
    
    ```./clean.job```

    ```./veryclean.job```
    
7.  What should I do if I want do 10 more steps after job finished?

      ```vi input.txt  #Set Maxstep = 30 (Suppose previous Maxstep is 20)```

      ``` writeCars >> WR.log```

      ```qsub run_mlpp.job```
   
8. What should I do if I want restore the job from an interruption?

   ```qsub run_mlpp.job  #CRYSTREE can restore from the breakpoint.```
### Steps for variable composition searching
1. Copy script templates:
   
   ```cp YOURPATH/crystree/crystree_templates/* ./```
   
2. Edit *run_vcs.job* and *run_mlpp.job*, tell CRYSTREE the information e.g. :
   
   ```vi ./run_vcs.job```
   
   ```
   CRYSTREE='YOURPATH/crystree'
   Title='coo'
   Elements='B N'      #Two elements
   Composition='XX YY' #No need to change
   Volume_factor=1.0   #No need to change
   Popsize=20          #Population for each step
   Ratio=0.6           #It means 60% of structures are generated by machine learning
   Pressure=50.0       #Unit is GPa
   Maxstep=20          #CRYSTREE must stop at Maxstep
   Stopit=5            #If lowest enthapy stays unchanged for "Stopit" steps, CRYSTREE stops
   MinAtoms=2          #MinAtoms and MaxAtoms control the boundary of VCS
   MaxAtoms=8
   ```
   
   ```vi ./run_mlpp.job```
   
   ```
   MAXTIME=1000                 #MAXTIME and WALLTIME control the maximal running time of VASP
   WALLTIME=1000
   VASP='YOURPATH/vasp_std'     #Give your path to vasp
   CRYSTREE='YOURPATH/crystree' #Give your path to CRYSTREE
   ......
   ```
   
3. Prepare *POTCAR* for each element, like *POTCAR_B*, *POTCAR_C*:
   
   ```cat PATH_TO_VASP-POT/B/POTCAR > POTCAR_B```

   ```cat PATH_TO_VASP-POT/C/POTCAR > POTCAR_C```
   
4. Run *run_vcs.job*, it will generate input files for each composition, and submit job automatically:
   
   ```./run_vcs.job```
   
5. We can use *convexhull.job* to collect enthalpies for all compositions, and plot convex hull using *convexhull*

   ```./convexhull.job```

   ```convexhull```
   
### Citation

   Miriam Peña-Alvarez*, **Bin Li**, Liam C. Kelsall, Jack Binns, Philip Dalladay-Simpson, Andreas Hermann, Ross T. Howie, and Eugene Gregoryanz*, Synthesis of Superconducting Cobalt Trihydride, J. Phys. Chem. Lett. 2020 11(15), 6420-6425.

   ```
   @article{doi:10.1021/acs.jpclett.0c01807,
   author = {Peña-Alvarez, Miriam and Li, Bin and Kelsall, Liam C. and Binns, Jack and Dalladay-Simpson, Philip and Hermann, Andreas and Howie, Ross T. and Gregoryanz, Eugene},
   title = {Synthesis of Superconducting Cobalt Trihydride},
   journal = {The Journal of Physical Chemistry Letters},
   volume = {11},
   number = {15},
   pages = {6420-6425},
   year = {2020},
   doi = {10.1021/acs.jpclett.0c01807},
       note ={PMID: 32658481},
   
   URL = { 
           https://doi.org/10.1021/acs.jpclett.0c01807
       
   },
   eprint = { 
           https://doi.org/10.1021/acs.jpclett.0c01807
       
   }
   
   }
   ```

   **Bin Li\***, Zilong Miao, Lei Ti, Shengli Liu, Jie Chen, Zhixiang Shi, and Eugene Gregoryanz, Predicted high-temperature superconductivity in cerium hydrides at high pressures, Journal of Applied Physics 2019, 126, 235901.

   ```
   @article{doi:10.1063/1.5130583,
   author = {Li,Bin  and Miao,Zilong  and Ti,Lei  and Liu,Shengli  and Chen,Jie  and Shi,Zhixiang  and Gregoryanz,Eugene },
   title = {Predicted high-temperature superconductivity in cerium hydrides at high pressures},
   journal = {Journal of Applied Physics},
   volume = {126},
   number = {23},
   pages = {235901},
   year = {2019},
   doi = {10.1063/1.5130583},
   
   URL = { 
           https://doi.org/10.1063/1.5130583
       
   },
   eprint = { 
           https://doi.org/10.1063/1.5130583
       
   }
   
   }
   ```

   
